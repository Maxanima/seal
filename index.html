<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Magic Seal Upgrade System</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      height: 100%;
      background: #000;
      color: #0ff;
      font-family: monospace, monospace;
      overflow-x: hidden;
      user-select: none;
    }
    body {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      min-height: 100vh;
      position: relative;
      padding: 20px 0;
    }
    #loading-screen {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: #000;
      color: #0ff;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      z-index: 9999;
    }

    #icons-container {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 20px;
      user-select: none;
      pointer-events: none;
    }

    #seal-container {
      position: relative;
      width: 100%;
      flex-grow: 1;
      aspect-ratio: 1 / 1;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    svg {
      display: block;
      width: 100%;
      height: 100%;
    }

    .glow {
      fill: none;
      stroke-width: 4;
      transform-origin: center center;
    }

    #buttons-container {
      display: flex;
      justify-content: space-between;
      padding: 0 40px;
      margin-top: 20px;
      user-select: none;
    }
    button {
      background: transparent;
      border: 2px solid #0ff;
      border-radius: 8px;
      padding: 12px 28px;
      font-size: 16px;
      font-weight: 600;
      color: #0ff;
      cursor: pointer;
      transition: background 0.3s, color 0.3s;
      user-select: none;
    }
    button:hover {
      background: #0ff;
      color: #000;
    }
  </style>
</head>
<body>
  <div id="loading-screen">Loading</div>
  <div id="icons-container"></div>
  <div id="seal-container"></div>
  <div id="buttons-container">
    <button id="reset-btn">Reset</button>
    <button id="add-figure-btn">Add Figure</button>
  </div>
  <audio id="upgrade-sound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_4ee6f27266.mp3?filename=correct-2-46134.mp3" preload="auto"></audio>
  <script>
    const colors = ['#FF5555', '#FFAA55', '#FFFF55', '#AAFF55', '#55FFAA', '#55FFFF', '#5599FF', '#AA55FF', '#FF55AA', '#00FFFF', '#FF00FF', '#00FF00'];
    const shapes = ['triangle', 'square', 'star', 'ring', 'hex', 'circle', 'diamond', 'pentagon'];
    const maxFigures = 4;

    let figures = [];
    let glowLevels = [2, 4, 8];
    let rotationSpeeds = [5.72 * 0.3 * 10, 3.41 * 0.3 * 10, 1.87 * 0.3 * 10]; // Уменьшено вращение на 90%

    const upgradeSound = document.getElementById('upgrade-sound');
    const iconsContainer = document.getElementById('icons-container');

    function randomChoice(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function createFigure(index) {
      const shape = randomChoice(shapes);
      const color = randomChoice(colors);
      const glow = Math.floor(Math.random() * glowLevels.length);
      const rotation = randomChoice(rotationSpeeds);
      return {
        shape,
        color,
        glow,
        rotation,
        complete: false,
        size: 100 - index * 15,
        id: `fig${index}`
      };
    }

    function updateIcons() {
      iconsContainer.innerHTML = figures.map(fig => `<div style="width: 20px; height: 20px; background: ${fig.color}; border-radius: 4px;"></div>`).join('');
    }

    function renderSeal() {
      figures.forEach(checkFigureComplete);
      let defs = '<defs>';
      figures.forEach((fig, i) => {
        defs += `
          <filter id="glow-${i}" x="-50%" y="-50%" width="200%" height="200%">
            <feDropShadow dx="0" dy="0" stdDeviation="${glowLevels[fig.glow]}" flood-color="${fig.color}"/>
          </filter>`;
      });
      defs += '</defs>';

      let svg = `<svg width="100%" height="100%" viewBox="0 0 300 300" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">`;
      svg += `<rect width="300" height="300" fill="black" />`;
      svg += defs;
      svg += [...figures].reverse().map((fig, i) => renderFigure(fig, figures.length - 1 - i)).join('');
      svg += '</svg>';
      document.getElementById('seal-container').innerHTML = svg;
      updateIcons();
    }

    function renderFigure(fig, i) {
      const cx = 150, cy = 150;
      const color = fig.color;
      const rotation = fig.rotation;
      const id = fig.id;
      const angle = (i % 2 === 0 ? 1 : -1) * 360;
      const animateTag = `<animateTransform attributeName="transform" attributeType="XML" type="rotate" from="0 150 150" to="${angle} 150 150" dur="${rotation}s" repeatCount="indefinite" />`;
      const commonAttrs = `class="glow" stroke="${color}" filter="url(#glow-${i})"`;

      switch (fig.shape) {
        case 'circle':
        case 'ring':
          return `<g transform="rotate(0 150 150)">${animateTag}<circle ${commonAttrs} cx="150" cy="150" r="${fig.size}" /></g>`;
        case 'triangle': {
          const s = fig.size;
          const h = s * Math.sqrt(3) / 2;
          const points = [
            [cx, cy - 2 / 3 * h],
            [cx - s / 2, cy + h / 3],
            [cx + s / 2, cy + h / 3]
          ].map(p => p.join(',')).join(' ');
          return `<g transform="rotate(0 150 150)">${animateTag}<polygon ${commonAttrs} points="${points}" /></g>`;
        }
        case 'square': {
          const s = fig.size;
          return `<g transform="rotate(0 150 150)">${animateTag}<rect ${commonAttrs} x="${cx - s/2}" y="${cy - s/2}" width="${s}" height="${s}" /></g>`;
        }
        case 'star': {
          const points = [];
          for (let j = 0; j < 10; j++) {
            const angle = Math.PI/2 + j * Math.PI/5;
            const r = (j % 2 === 0) ? fig.size : fig.size/2;
            const x = cx + r * Math.cos(angle);
            const y = cy - r * Math.sin(angle);
            points.push(`${x},${y}`);
          }
          return `<g transform="rotate(0 150 150)">${animateTag}<polygon ${commonAttrs} points="${points.join(' ')}" /></g>`;
        }
        case 'hex': {
          const points = [];
          for (let j = 0; j < 6; j++) {
            const angle = Math.PI / 6 + j * Math.PI / 3;
            const x = cx + fig.size * Math.cos(angle);
            const y = cy + fig.size * Math.sin(angle);
            points.push(`${x},${y}`);
          }
          return `<g transform="rotate(0 150 150)">${animateTag}<polygon ${commonAttrs} points="${points.join(' ')}" /></g>`;
        }
        case 'diamond': {
          const s = fig.size;
          return `<g transform="rotate(0 150 150)">${animateTag}<polygon ${commonAttrs} points="${cx},${cy - s} ${cx + s},${cy} ${cx},${cy + s} ${cx - s},${cy}" /></g>`;
        }
        case 'pentagon': {
          const points = [];
          for (let j = 0; j < 5; j++) {
            const angle = Math.PI / 2 + j * 2 * Math.PI / 5;
            const x = cx + fig.size * Math.cos(angle);
            const y = cy - fig.size * Math.sin(angle);
            points.push(`${x},${y}`);
          }
          return `<g transform="rotate(0 150 150)">${animateTag}<polygon ${commonAttrs} points="${points.join(' ')}" /></g>`;
        }
        default:
          return '';
      }
    }

    function checkFigureComplete(fig) {
      if (fig.glow >= 0 && fig.rotation > 0) {
        fig.complete = true;
      }
    }

    function resetGame() {
      figures = [createFigure(0)];
      checkFigureComplete(figures[0]);
      renderSeal();
    }

    document.getElementById('reset-btn').onclick = resetGame;
    document.getElementById('add-figure-btn').onclick = () => {
      if (figures.length < maxFigures) {
        const fig = createFigure(figures.length);
        checkFigureComplete(fig);
        figures.push(fig);
        renderSeal();
      }
    };

    window.addEventListener('load', () => {
      document.getElementById('loading-screen').style.display = 'none';
      resetGame();
    });
  </script>
</body>
</html>
